# 台球游戏分析

## 1.要求（需求分析）

基于 libgraphics，实现一个简易的台球游戏程序，支持游戏过程保存和读取功能。
**基本要求：**
	1）同时支持二进制和文本文件形式的保存和读取。
	2）设计实现至少 3 种不同风格和游戏规则的台球游戏（每个队员完成至少 1 种）。
	3）支持二人对战。

## 2.评分标准

**大程序评分门槛：**
系统源代码编译能顺利通过，程序可运行。（此条为大程可以评价的起点，即达不
到没有分）
		**组分评价要点**
	1） 专题知识的应用度（多文件组成、Windows Application 工程、递归函数、高级指针、
	链表、（二进制）文件读写、位运算、GUI 界面（图形库必须用课程要求的 libgraphics）、
	编程规范）（40 分）
	2） 界面的用户友好性（画面美观、菜单、按钮等图形控件的合理使用、支持鼠标、键
	盘等交互操作，操作容易）（10 分）
	3） 系统功能的完善性、扩展性和创新性。（即有故事，而非单纯的画图）（20 分）
	4） 算法设计和数据结构设计的质量和亮点（10 分）
	5） 代码的规范性（5 分）
	6） 报告撰写的质量（10 分）
	7） 验收的表现（5 分）
		**组内个人分上下调整要点**：根据个人的贡献和工作量、态度等进行基于组分的上下调整。

## 3.**主体功能描述：**

程序运行首先显示开始页面，点击Message显示游戏说明，点击Play进入游戏。杆随着鼠标而围着母球旋转，点击鼠标杆停止不动确定出杆方向，此时力度条开始滑动，点击空格母球发出、杆消失。待所有球停下杆重新出现，由之前的黄色变成蓝色，即由玩家一转换到玩家二。相应玩家打球进洞会有得分，如果母球进洞减10分。按ESC键进入暂停界面，按1继续之前的游戏，按2显示结束页面。如果所有球都进洞显示结束页面。

startup()函数将全局变量进行初始化，该函数只运行一次。

show()函数负责显示，clean()函数负责将前一帧画面擦掉，两者交替进行可实现物体移动效果。

updatewithinput()接受用户输入，比如点击鼠标、按空格键。

updatewithoutinput()函数中无需输入各个变量自行更新，如小球无需控制会滑行。

boom()函数在updatewithoutinput()中调用，实现了球之间的碰撞。为了简化处理，每一时刻只处理距离最近的一对球的碰撞，循环运行会产生多球同时碰撞的效果。

startMenu()、pauseMenu()和gameOver()函数显示不同的画面，gameStatus变量的值确定程序显示哪个界面。

球的碰撞是实现难点。球与壁之间是镜面反射，球与球之间存在对心碰撞与非对心碰撞两种情况。碰撞后速度的变化需尽可能真实，否则将影响可玩性。具体实现时每次找到距离最小的一对小球进行碰撞，多次循环以模拟多对球同时发生碰撞的效果。对于非对心碰撞引入向量的概念，速度在垂直于球心连线的方向不变，而在球心连线方向重新分配。

引入一个变量，初始值为零，每一杆进洞该变量加一。根据其是奇数还是偶数，设为不同的玩家操作。

## 4.**主要实现步骤：**

1. 搭建基本框架

2. 实现杆绕球旋转、杆的方向控制球的方向

3. 实现多球碰撞、球壁碰撞

4. 加入阻尼力模拟物理世界

5. 初始化球的位置

6. 导入图片

7. 加入力度条
8. 加入规则与得分机制



## 5. 物理模型

台球游戏中, 最核心的就是其**物理模型的抽象**及其**碰撞算法的执行过程**了.
    　　鉴于是2D版的台球游戏, 因此我们对物理模型做下简化, 球运动的方向必然穿越球的中心.
    　　把每个台球抽象为圆(x, y, radius), 而台球桌边框抽象为线段((x1, y1), (x2, y2)).
    　　• **碰撞检测**
    　　1). **检测球与球碰撞**
    　　我们假定球A(x1, y1, r), 球B(x2, y2, r). 则满足条件:
    　　(x1 - x2) ^ 2 + (y1 - y2) ^ 2 <= (2*r) ^ 2
    　　则发生碰撞, 否则没有发生碰撞
    　　2). **检测球与球台边框碰撞**
    　　相对比较简单. 求球心到边框的垂直距离即可, 若小于等于则发生碰撞, 若大于则没有.
    　　• **碰撞反应**   
    　　1). **球与球的碰撞反应**
    　　![img](https://images0.cnblogs.com/blog2015/305284/201505/120937426261562.png)
    　　动量是向量, 其在正交的两个方向上, 互相守恒. 我们选取**两球圆心的直线为x轴**, **垂直于圆心直线的为y轴**. 如上图所述.
    　　x轴上满足动量守恒:
    　　m1 * Vx + m2 * Ux = m1 * Vx' + m2 * Ux';
    　　并假定两球碰撞是完全弹性碰撞, 两球质量相等m1=m2, 依据基础物理知识篇的结论.
    　　Vx' = [(m1-m2) * Vx + 2 * m2 * Ux] / (m1 + m2) = Ux;
    　　Ux' = [(m2-m1) * Ux + 2 * m1 * Vx] / (m1 + m2) = Vx;
    　　在X轴方向, 两球交换速度, 而在Y轴方向, 两球分速度不变.
    　　Vy' = Vy;
    　　Uy' = Uy;
    　　**最终碰撞后的速度公式为:**
    　　V' = Vx' + Vy' = Ux + Vy;
    　　U' = Ux' + Uy' = Vx + Uy;
    　　2). **球与边框的碰撞反应**    
    　　把台球边框视为质量无穷大, 则简单把运动的球, 其在垂直边框的分方向反向即可.
    　　![img](https://images0.cnblogs.com/blog2015/305284/201505/120937592206990.png)
    　　假定碰撞碰撞平面为x轴
    　　Vx' = Vx;
    　　Vy' = -Vy;
    　　**最终速度公式为:**
    　　V' = Vx' + Vy' = Vx - Vy;



